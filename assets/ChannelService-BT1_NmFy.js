class i{constructor(){this._state="idle",this.listeners=new Set}state(){return this._state}emit(t){this._state=t,this.listeners.forEach(e=>e(t))}onState(t){return this.listeners.add(t),t(this._state),()=>this.listeners.delete(t)}async open(t){if(this.emit("opening"),await new Promise(e=>setTimeout(e,400)),t.matchId.startsWith("fail"))throw this.emit("error"),new Error("CHANNEL_OPEN_FAILED");return this.emit("open"),{channelId:t.channelId??`ch_${Math.random().toString(36).slice(2,8)}`}}async close(){await new Promise(t=>setTimeout(t,100)),this.emit("idle")}}export{i as M};
